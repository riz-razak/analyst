<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Corruption Network Map — Sri Lanka Cricket Dossier</title>
  <meta name="description" content="Interactive network map: 45 nodes, 70+ verified connections in Sri Lanka's cricket betting corruption web.">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: #0a0a0f;
      color: #e0e0e8;
      overflow: hidden;
      width: 100vw;
      height: 100vh;
    }

    nav {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 44px;
      background: rgba(10, 10, 15, 0.95);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      z-index: 100;
    }

    nav a {
      color: #888;
      text-decoration: none;
      font-size: 13px;
      transition: color 0.2s;
    }

    nav a:hover {
      color: #ccc;
    }

    nav .nav-center {
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 1px;
      color: #aaa;
    }

    nav .nav-right {
      font-size: 12px;
      color: #999;
      font-weight: 500;
    }

    #map {
      position: absolute;
      top: 44px;
      left: 0;
      right: 0;
      bottom: 0;
      cursor: grab;
    }

    #map:active {
      cursor: grabbing;
    }

    #legend {
      position: absolute;
      top: 60px;
      right: 20px;
      background: rgba(15, 15, 25, 0.92);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 8px;
      padding: 16px;
      backdrop-filter: blur(8px);
      z-index: 200;
      max-width: 240px;
      font-size: 12px;
    }

    .legend-title {
      font-weight: 600;
      margin-bottom: 12px;
      color: #ccc;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      transition: background 0.15s;
    }

    .legend-item:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .legend-item input[type="checkbox"] {
      cursor: pointer;
      accent-color: #ff9900;
    }

    .legend-swatch {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    #node-popup,
    #link-popup {
      position: fixed;
      background: rgba(15, 15, 25, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 16px;
      font-size: 13px;
      max-width: 340px;
      backdrop-filter: blur(8px);
      z-index: 300;
      display: none;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    #node-popup.visible,
    #link-popup.visible {
      display: block;
    }

    .popup-close {
      position: absolute;
      top: 8px;
      right: 8px;
      background: none;
      border: none;
      color: #888;
      font-size: 20px;
      cursor: pointer;
      transition: color 0.2s;
    }

    .popup-close:hover {
      color: #ccc;
    }

    .popup-label {
      font-weight: 600;
      margin-bottom: 8px;
      color: #fff;
    }

    .popup-desc {
      color: #aaa;
      line-height: 1.5;
      margin-bottom: 10px;
    }

    .popup-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    .popup-tag {
      display: inline-block;
      background: rgba(255, 153, 0, 0.15);
      color: #ff9900;
      padding: 3px 8px;
      border-radius: 3px;
      font-size: 11px;
      border: 1px solid rgba(255, 153, 0, 0.3);
    }

    .popup-fact-header {
      font-weight: 600;
      margin-bottom: 8px;
      color: #fff;
      font-size: 12px;
    }

    .fact-label {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 3px;
      font-weight: 600;
      font-size: 11px;
      margin-right: 8px;
    }

    .fact-label.verified {
      background: rgba(68, 200, 136, 0.2);
      color: #44c888;
      border: 1px solid rgba(68, 200, 136, 0.4);
    }

    .fact-label.reported {
      background: rgba(255, 153, 0, 0.2);
      color: #ff9900;
      border: 1px solid rgba(255, 153, 0, 0.4);
    }

    .fact-label.partially {
      background: rgba(204, 204, 68, 0.2);
      color: #cccc44;
      border: 1px solid rgba(204, 204, 68, 0.4);
    }

    .popup-fact-text {
      color: #aaa;
      line-height: 1.5;
      margin-top: 8px;
    }

    #embed-panel {
      position: absolute;
      bottom: 20px;
      right: 20px;
      z-index: 150;
    }

    #embed-toggle {
      background: rgba(15, 15, 25, 0.92);
      border: 1px solid rgba(255, 255, 255, 0.15);
      color: #888;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      font-family: 'JetBrains Mono', monospace;
      transition: all 0.2s;
      backdrop-filter: blur(8px);
    }

    #embed-toggle:hover {
      border-color: rgba(255, 255, 255, 0.3);
      color: #ccc;
    }

    #embed-code {
      background: rgba(15, 15, 25, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 8px;
      padding: 12px;
      margin-top: 8px;
      max-width: 500px;
      backdrop-filter: blur(8px);
    }

    #embed-code pre {
      background: rgba(0, 0, 0, 0.3);
      padding: 12px;
      border-radius: 6px;
      overflow-x: auto;
      margin-bottom: 10px;
    }

    #embed-code code {
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
      color: #aaa;
      line-height: 1.4;
    }

    #copy-embed {
      background: rgba(255, 153, 0, 0.2);
      border: 1px solid rgba(255, 153, 0, 0.4);
      color: #ff9900;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 11px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }

    #copy-embed:hover {
      background: rgba(255, 153, 0, 0.3);
      border-color: rgba(255, 153, 0, 0.6);
      color: #ffb333;
    }

    @keyframes pulse-ring {
      0% {
        r: 35;
        stroke-width: 2;
        opacity: 1;
      }
      100% {
        r: 50;
        stroke-width: 1;
        opacity: 0;
      }
    }

    .convicted-pulse {
      animation: pulse-ring 2s infinite;
    }
  </style>
</head>
<body>
  <nav>
    <a href="./index.html">← Back to Dossier</a>
    <div class="nav-center">SRI LANKA CRICKET — CORRUPTION NETWORK MAP</div>
    <div class="nav-right" style="display:flex;align-items:center;gap:12px;">
      <span id="node-count" style="opacity:0.7;font-size:11px;">43 nodes · 62 links</span>
      <button id="expand-toggle" onclick="toggleExpanded()" style="
        background:transparent;
        border:1px solid rgba(255,255,255,0.3);
        color:#e0e0e0;
        font-size:11px;
        font-family:inherit;
        padding:3px 10px;
        border-radius:12px;
        cursor:pointer;
        transition:all 0.2s;
      " onmouseover="this.style.borderColor='rgba(255,255,255,0.7)'"
         onmouseout="this.style.borderColor='rgba(255,255,255,0.3)'">
        ⊕ Expanded
      </button>
    </div>
  </nav>

  <svg id="map" width="100%" height="100%">
    <defs>
      <!-- Glow + drop-shadow for nodes -->
      <filter id="glow" x="-60%" y="-60%" width="220%" height="220%">
        <feGaussianBlur in="SourceAlpha" stdDeviation="5" result="blur"/>
        <feOffset dx="2" dy="4" result="shadowOffset"/>
        <feFlood flood-color="#000000" flood-opacity="0.55" result="shadowColor"/>
        <feComposite in="shadowColor" in2="shadowOffset" operator="in" result="shadow"/>
        <feGaussianBlur in="SourceGraphic" stdDeviation="2.5" result="coloredBlur"/>
        <feMerge>
          <feMergeNode in="shadow"/>
          <feMergeNode in="coloredBlur"/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
      <!-- Specular highlight — top-left bright spot for sphere illusion -->
      <radialGradient id="specular" cx="36%" cy="30%" r="58%">
        <stop offset="0%"   stop-color="white" stop-opacity="0.60"/>
        <stop offset="45%"  stop-color="white" stop-opacity="0.18"/>
        <stop offset="100%" stop-color="white" stop-opacity="0"/>
      </radialGradient>
      <!-- Bottom shadow — darkens the lower hemisphere -->
      <radialGradient id="sphere-shadow" cx="58%" cy="68%" r="58%">
        <stop offset="0%"   stop-color="black" stop-opacity="0.42"/>
        <stop offset="100%" stop-color="black" stop-opacity="0"/>
      </radialGradient>
    </defs>
    <g id="canvas">
      <g id="links-layer"></g>
      <g id="nodes-layer"></g>
    </g>
  </svg>

  <div id="legend">
    <div class="legend-title">Node Types</div>
  </div>

  <div id="node-popup">
    <button class="popup-close">×</button>
    <div class="popup-label" id="popup-label"></div>
    <div class="popup-desc" id="popup-desc"></div>
    <div class="popup-tags" id="popup-tags"></div>
  </div>

  <div id="link-popup">
    <button class="popup-close">×</button>
    <div class="popup-fact-header" id="popup-fact-header"></div>
    <div class="popup-fact-text" id="popup-fact-text"></div>
  </div>

  <div id="embed-panel">
    <button id="embed-toggle">&lt; &gt; Get embed code</button>
    <div id="embed-code">
      <pre><code>&lt;iframe src="https://analyst.rizrazak.com/dossiers/sri-lanka-cricket-corruption/mindmap.html" width="100%" height="720" frameborder="0" style="border-radius:12px;border:1px solid rgba(255,255,255,0.1);" allowfullscreen title="Sri Lanka Cricket Corruption Network Map"&gt;&lt;/iframe&gt;</code></pre>
      <button id="copy-embed">Copy</button>
    </div>
  </div>

  <script>
    // ============ DATA ============
    const typeColors = {
      slc: "#ff9900",
      betting: "#ff4444",
      government: "#4488ff",
      celebrity: "#aa44ff",
      criminal: "#ff2266",
      corporate: "#44cc88",
      jurisdiction: "#cccc44",
      convicted: "#888888"
    };

    const nodes = [
      { id: "slc", label: "Sri Lanka Cricket", type: "slc", size: 38, desc: "National cricket board. Approved illegal betting sponsors for LPL and national team jerseys. 22 live ICC ACU corruption investigations at one point.", tags: ["slc"] },
      { id: "sumathipala", label: "Thilanga Sumathipala", type: "slc", size: 30, desc: "Former SLC President & Deputy Speaker of Parliament. Family owns Sporting Star bookmaking business (est. 1956). Banned from SLC office by ICC. Still influences SLC through proxies.", tags: ["slc"] },
      { id: "shammi", label: "Shammi Silva", type: "slc", size: 26, desc: "SLC President since Feb 2019, now in 4th term. Called 'Betting Shammi' by Sports Minister Ranasinghe. Father Piyasena De Silva was manager of Sumathipala's Sporting Star.", tags: ["slc"] },
      { id: "ashley", label: "Ashley de Silva", type: "slc", size: 20, desc: "SLC CEO for over a decade. Sits on LPL governing council. Oversees tournament operations including sponsor approvals.", tags: ["slc"] },
      { id: "mohan", label: "Mohan de Silva", type: "slc", size: 16, desc: "SLC Secretary. Claimed 1xBat sponsorship was approved by Asia Cricket Council. Attended ICC Board meetings with Sumathipala.", tags: ["slc"] },
      { id: "melbet", label: "Melbet", type: "betting", size: 26, desc: "1xBet sub-brand. Pelican Entertainment B.V., Curaçao #134359. Shares same IP, odds, and backend as 1xBet. Advertised on ThePapare/Dialog. Banned in India, UK, France, and others.", tags: ["betting"] },
      { id: "1xbet", label: "1xBet / 1xBat", type: "betting", size: 30, desc: "Russian-founded, Cyprus HQ. ~1,800 affiliated sites on blacklists worldwide. 1xBat was official Sri Lanka Asia Cup 2023 sponsor. Founded by Semiokhin, Kazorin, Karshkov.", tags: ["betting"] },
      { id: "wolf777", label: "Wolf777", type: "betting", size: 22, desc: "Owner: Rakesh Rajdev (Gujarat/Dubai). GIT Operations NV, Curaçao. Ahmedabad Crime Branch lookout notice. ₹1,400 crore betting racket. Back-of-jersey sponsor for SL India Tour 2022.", tags: ["betting"] },
      { id: "kheloyar", label: "Kheloyar", type: "betting", size: 24, desc: "Mahadev Book network. Operated by Saurabh Chandrakar + Mustaqim Ibrahim Kaskar (Dawood Ibrahim's brother). ₹300-500 crore investment. ₹200 crore daily turnover across 60 apps.", tags: ["betting", "criminal"] },
      { id: "crickex", label: "Crickex", type: "betting", size: 18, desc: "VB Digital N.V., Curaçao/Cyprus. Multiple fraud complaints. Robin Uthappa is brand ambassador. Accused of freezing winning accounts.", tags: ["betting"] },
      { id: "stbet", label: "STBet / Sporting Star", type: "betting", size: 24, desc: "Sumathipala family's platform. Sporting Star est. 1956 → Sporting Times → STBet.com. 1,000+ employees. Curaçao licence 8047/JAZ. The very business that got Sumathipala banned from SLC.", tags: ["betting", "slc"] },
      { id: "skyfair", label: "Skyfair", type: "betting", size: 16, desc: "LPL 2023 title sponsor. Sky Infotech N.V., Curaçao #152377. Named as 'illegal offshore betting website' by Justice Minister in Parliament.", tags: ["betting"] },
      { id: "semiokhin", label: "Roman Semiokhin", type: "criminal", size: 20, desc: "1xBet co-founder. 'Bryansk billionaire.' Cypriot citizenship. On Russia's international wanted list. 63 billion rubles in illegal gambling.", tags: ["criminal"] },
      { id: "karshkov", label: "Sergey Karshkov", type: "criminal", size: 18, desc: "1xBet co-founder. Former head of Bryansk cybercrime unit (Russian MVD). Died June 2023 — 'anaphylactic shock' during routine Swiss medical exam. Age 42. On Russia's wanted list.", tags: ["criminal"] },
      { id: "dawood", label: "Dawood Ibrahim Network", type: "criminal", size: 22, desc: "D-Company. Kheloyar operated in partnership with Mustaqim Ibrahim Kaskar (Dawood's brother). Protection money paid to D-Company and allegedly to Pakistan's ISI.", tags: ["criminal"] },
      { id: "rajdev", label: "Rakesh Rajdev", type: "criminal", size: 18, desc: "Wolf777 owner. Gujarat/Dubai. Ahmedabad Crime Branch lookout. Nagpur police wanted (₹58 crore scam). ED found ₹170.70 crore through one fraudulent bank account.", tags: ["criminal"] },
      { id: "chandrakar", label: "Saurabh Chandrakar", type: "criminal", size: 18, desc: "Kheloyar/Mahadev Book operator. Arrested in Dubai on Interpol Red Corner Notice 2024. Paid protection to D-Company. ₹200 crore daily through 60 apps.", tags: ["criminal", "convicted"] },
      { id: "wickremesinghe", label: "Ranil Wickremesinghe", type: "government", size: 24, desc: "President (2022-2024). Fired Sports Minister Ranasinghe for dissolving SLC board. Effectively shielded Shammi Silva's administration.", tags: ["government"] },
      { id: "ranasinghe", label: "Roshan Ranasinghe", type: "government", size: 20, desc: "Sports Minister who called Silva 'Betting Shammi.' Dissolved SLC board. Was fired by Wickremesinghe from ALL ministerial positions.", tags: ["government"] },
      { id: "wijedasa", label: "Wijedasa Rajapaksa", type: "government", size: 18, desc: "Justice Minister. Named 15 illegal betting sites sponsoring LPL in Parliament (Aug 2023). Called Skyfair 'illegal offshore betting website.' Nothing happened.", tags: ["government"] },
      { id: "harin", label: "Harin Fernando", type: "government", size: 22, desc: "Sports Minister (2018-19, 2023-24). Banned Sumathipala from SLC. Passed match-fixing law. Reported bribery attempt. But also restored Silva board after Ranasinghe's removal.", tags: ["government"] },
      { id: "dissanayake", label: "Anura K. Dissanayake", type: "government", size: 22, desc: "Current President (NPP). Passed GRA Act 2025. Raised gaming tax to 45%. GRA operational June 2026. Focus on regulation, not prohibition.", tags: ["government"] },
      { id: "dialog", label: "Dialog Axiata", type: "corporate", size: 26, desc: "Sri Lanka's largest telecom. Owns ThePapare. ICC broadcast rights until 2028. National team sponsor ($4.8M). Runs Melbet ads on ThePapare. Too powerful to challenge.", tags: ["corporate"] },
      { id: "ipg", label: "IPG Dubai", type: "corporate", size: 20, desc: "Indian-owned Dubai company. Holds LPL marketing, broadcast, franchise, and sponsorship rights since 2020. Controls who sponsors teams. Beyond Sri Lankan jurisdiction.", tags: ["corporate"] },
      { id: "papare", label: "ThePapare", type: "corporate", size: 18, desc: "Sri Lanka's leading cricket website. Owned by Dialog Axiata. Carries Melbet advertising. ICC broadcast partner's content arm promoting illegal betting.", tags: ["corporate"] },
      { id: "watson", label: "Shane Watson", type: "celebrity", size: 18, desc: "Australia. Melbet global ambassador (2021) AND Wolf777 ambassador (2023). Endorsed TWO illegal platforms targeting same markets simultaneously.", tags: ["celebrity"] },
      { id: "raina", label: "Suresh Raina", type: "celebrity", size: 16, desc: "India. 1xBet endorser. ED attached ₹6.64 crore in mutual funds. Alleged to have 'knowingly' signed deals with 1xBet foreign entities.", tags: ["celebrity", "convicted"] },
      { id: "dhawan", label: "Shikhar Dhawan", type: "celebrity", size: 16, desc: "India. 1xBet endorser. ED attached ₹4.5 crore in immovable property.", tags: ["celebrity", "convicted"] },
      { id: "yuvraj", label: "Yuvraj Singh", type: "celebrity", size: 16, desc: "India. 1xBet endorser. ED attached ₹2.5 crore via YWC Health and Wellness Pvt. Ltd.", tags: ["celebrity", "convicted"] },
      { id: "uthappa", label: "Robin Uthappa", type: "celebrity", size: 16, desc: "India. Crickex brand ambassador AND 1xBet endorser. ED attached ₹8.26 lakh.", tags: ["celebrity", "convicted"] },
      { id: "pollard", label: "Kieron Pollard", type: "celebrity", size: 16, desc: "West Indies. 1xBet India ambassador (2-year deal). Featured on Delhi billboards and auto-rickshaw ads.", tags: ["celebrity"] },
      { id: "bravo", label: "Dwayne Bravo", type: "celebrity", size: 16, desc: "West Indies. FIRST 1xBet brand ambassador in India (Sep 2021). Full-page Times of India ads.", tags: ["celebrity"] },
      { id: "iniesta", label: "Andrés Iniesta", type: "celebrity", size: 16, desc: "Spain/Barcelona legend. Melbet global ambassador. 'The Greatest 8' campaign.", tags: ["celebrity"] },
      { id: "babar", label: "Babar Azam", type: "celebrity", size: 18, desc: "Pakistan captain. REFUSED to wear betting logos on Colombo Strikers jersey. Appeared in blank jersey. Added 'no betting clause' to all contracts.", tags: ["celebrity"] },
      { id: "rahman", label: "Tamim Rahman", type: "convicted", size: 16, desc: "Dambulla Thunders owner. Pled guilty Jan 2026. 4-year suspended sentence + LKR 24M fine. First LPL franchise owner convicted.", tags: ["convicted"] },
      { id: "senanayake", label: "Sachithra Senanayake", type: "convicted", size: 16, desc: "SL cricketer. Indicted June 2025 — first criminal prosecution. Approached player via WhatsApp during LPL 2020 to underperform. Failed to appear in court.", tags: ["convicted"] },
      { id: "jayasuriya", label: "Sanath Jayasuriya", type: "convicted", size: 16, desc: "SL legend. 2-year ICC ban (2019) for refusing to cooperate with ACU investigation.", tags: ["convicted"] },
      { id: "jayasundara", label: "Sanath Jayasundara", type: "convicted", size: 14, desc: "SLC analyst. Charged by ICC for attempting to bribe Sports Minister Harin Fernando to influence match outcomes. Banned.", tags: ["convicted"] },
      { id: "curacao", label: "Curaçao", type: "jurisdiction", size: 22, desc: "Caribbean island issuing bulk offshore gambling licences. Near-zero transparency on beneficial owners. Home jurisdiction for Melbet, 1xBet affiliates, Wolf777, Crickex, Skyfair, STBet.", tags: [] },
      { id: "cyprus", label: "Cyprus", type: "jurisdiction", size: 16, desc: "1xBet HQ (Limassol). Payment processing for Melbet (Edric Ltd, Faren Ltd). Semiokhin and Kazorin hold Cypriot citizenship.", tags: [] },
      { id: "dubai", label: "Dubai / UAE", type: "jurisdiction", size: 18, desc: "IPG headquarters. Chandrakar arrested here. Rajdev operates from here. Beyond Sri Lankan law enforcement reach.", tags: [] },
      { id: "icc", label: "ICC", type: "corporate", size: 24, desc: "Suspended SLC for 'government interference' when Ranasinghe tried to clean house. Anti-Corruption Code prohibits gambling ties — never enforced against SLC. ACU had 22 live SL investigations.", tags: ["corporate"] },
      { id: "marshall", label: "Alex Marshall", type: "corporate", size: 16, desc: "ICC ACU head (retired). Deployed Steve Richardson to Colombo. Briefed SL President and PM on corruption depth. Called SL a 'good news story' — debatable.", tags: ["corporate"] },
    ];

    const links = [
      { source: "sumathipala", target: "stbet", strength: 5, label: "Family owns", type: "solid" },
      { source: "sumathipala", target: "shammi", strength: 5, label: "Installed as proxy", type: "solid" },
      { source: "sumathipala", target: "slc", strength: 4, label: "Controlled via proxies", type: "dashed" },
      { source: "shammi", target: "slc", strength: 5, label: "President since 2019", type: "solid" },
      { source: "ashley", target: "slc", strength: 4, label: "CEO", type: "solid" },
      { source: "mohan", target: "slc", strength: 3, label: "Secretary", type: "solid" },
      { source: "mohan", target: "sumathipala", strength: 3, label: "Attended ICC meetings together", type: "dashed" },
      { source: "slc", target: "1xbet", strength: 4, label: "Asia Cup 2023 sponsor", type: "solid" },
      { source: "slc", target: "wolf777", strength: 3, label: "National team jersey 2022", type: "solid" },
      { source: "slc", target: "skyfair", strength: 3, label: "LPL title sponsor", type: "solid" },
      { source: "slc", target: "kheloyar", strength: 3, label: "LPL team sponsor", type: "solid" },
      { source: "slc", target: "crickex", strength: 2, label: "LPL team sponsor", type: "solid" },
      { source: "slc", target: "melbet", strength: 2, label: "Advertising ecosystem", type: "dashed" },
      { source: "1xbet", target: "melbet", strength: 5, label: "Same platform/backend", type: "solid" },
      { source: "1xbet", target: "semiokhin", strength: 5, label: "Co-founder", type: "solid" },
      { source: "1xbet", target: "karshkov", strength: 5, label: "Co-founder (deceased)", type: "solid" },
      { source: "1xbet", target: "curacao", strength: 4, label: "Licensed", type: "solid" },
      { source: "1xbet", target: "cyprus", strength: 4, label: "HQ & payments", type: "solid" },
      { source: "melbet", target: "curacao", strength: 4, label: "Licensed", type: "solid" },
      { source: "melbet", target: "cyprus", strength: 3, label: "Payment processing", type: "solid" },
      { source: "kheloyar", target: "dawood", strength: 5, label: "Dawood's brother is partner", type: "solid" },
      { source: "kheloyar", target: "chandrakar", strength: 5, label: "Operator", type: "solid" },
      { source: "chandrakar", target: "dubai", strength: 3, label: "Arrested here", type: "solid" },
      { source: "wolf777", target: "rajdev", strength: 5, label: "Owner", type: "solid" },
      { source: "wolf777", target: "curacao", strength: 3, label: "GIT Operations NV", type: "solid" },
      { source: "rajdev", target: "dubai", strength: 3, label: "Operates from", type: "solid" },
      { source: "stbet", target: "curacao", strength: 3, label: "Licence 8047/JAZ", type: "solid" },
      { source: "dialog", target: "papare", strength: 5, label: "Owns", type: "solid" },
      { source: "dialog", target: "slc", strength: 4, label: "$4.8M sponsor + broadcast rights", type: "solid" },
      { source: "dialog", target: "icc", strength: 3, label: "Broadcast rights to 2028", type: "solid" },
      { source: "papare", target: "melbet", strength: 4, label: "Carries ads for", type: "solid" },
      { source: "ipg", target: "slc", strength: 4, label: "LPL rights holder", type: "solid" },
      { source: "ipg", target: "dubai", strength: 3, label: "Based in", type: "solid" },
      { source: "wickremesinghe", target: "shammi", strength: 4, label: "Protected board / fired reformer", type: "solid" },
      { source: "wickremesinghe", target: "ranasinghe", strength: 4, label: "Fired from all ministries", type: "solid" },
      { source: "wickremesinghe", target: "harin", strength: 3, label: "Appointed replacement", type: "solid" },
      { source: "ranasinghe", target: "shammi", strength: 4, label: "Dissolved board / called 'Betting Shammi'", type: "solid" },
      { source: "harin", target: "sumathipala", strength: 4, label: "Banned from SLC", type: "solid" },
      { source: "harin", target: "shammi", strength: 3, label: "Restored board", type: "dashed" },
      { source: "harin", target: "icc", strength: 3, label: "Negotiated suspension lift", type: "solid" },
      { source: "harin", target: "jayasundara", strength: 3, label: "Reported bribery attempt", type: "solid" },
      { source: "wijedasa", target: "skyfair", strength: 3, label: "Named as illegal in Parliament", type: "solid" },
      { source: "dissanayake", target: "slc", strength: 2, label: "GRA Act 2025", type: "solid" },
      { source: "icc", target: "slc", strength: 4, label: "Suspended / 22 investigations", type: "solid" },
      { source: "marshall", target: "icc", strength: 4, label: "ACU Head", type: "solid" },
      { source: "marshall", target: "slc", strength: 3, label: "Investigated", type: "solid" },
      { source: "watson", target: "melbet", strength: 3, label: "Global ambassador 2021", type: "solid" },
      { source: "watson", target: "wolf777", strength: 3, label: "Ambassador 2023", type: "solid" },
      { source: "raina", target: "1xbet", strength: 3, label: "Endorser — ₹6.64cr seized", type: "solid" },
      { source: "dhawan", target: "1xbet", strength: 3, label: "Endorser — ₹4.5cr seized", type: "solid" },
      { source: "yuvraj", target: "1xbet", strength: 3, label: "Endorser — ₹2.5cr seized", type: "solid" },
      { source: "uthappa", target: "crickex", strength: 3, label: "Brand ambassador", type: "solid" },
      { source: "uthappa", target: "1xbet", strength: 2, label: "Also endorsed", type: "dashed" },
      { source: "pollard", target: "1xbet", strength: 3, label: "India ambassador", type: "solid" },
      { source: "bravo", target: "1xbet", strength: 3, label: "First India ambassador", type: "solid" },
      { source: "iniesta", target: "melbet", strength: 3, label: "Global ambassador", type: "solid" },
      { source: "babar", target: "kheloyar", strength: 2, label: "REFUSED to wear logo", type: "dashed" },
      { source: "rahman", target: "slc", strength: 3, label: "Thunders owner — convicted", type: "solid" },
      { source: "senanayake", target: "slc", strength: 3, label: "SL cricketer — indicted", type: "solid" },
      { source: "jayasuriya", target: "slc", strength: 2, label: "2-year ACU ban", type: "solid" },
      { source: "crickex", target: "curacao", strength: 3, label: "VB Digital NV", type: "solid" },
      { source: "skyfair", target: "curacao", strength: 3, label: "Sky Infotech NV", type: "solid" },
    ];

    const linkFacts = {
      "sumathipala→stbet": "VERIFIED: Sumathipala family owns Sporting Star (est. 1956), which operates through Sporting Times → STBet.com. Company registration records confirm ownership. Sumathipala's ICC ban specifically cited this business conflict of interest.",
      "sumathipala→shammi": "VERIFIED: Shammi Silva's father Piyasena De Silva was manager at Sumathipala's Sporting Star bookmaking business. Silva rose to SLC presidency with Sumathipala's backing. Sports Minister Ranasinghe publicly called Silva 'Betting Shammi' in Parliament.",
      "sumathipala→slc": "VERIFIED: Despite ICC ban from holding office, Sumathipala continues to influence SLC through installed proxies. ICC's own investigation confirmed this patronage network.",
      "shammi→slc": "VERIFIED: Shammi Silva has been SLC President since Feb 2019, now serving 4th term. His tenure coincides with the largest proliferation of illegal betting sponsors in SLC history.",
      "ashley→slc": "VERIFIED: Ashley de Silva served as CEO for over a decade. Sits on LPL governing council. All sponsor approvals go through his office.",
      "mohan→slc": "VERIFIED: Mohan de Silva serves as SLC Secretary. He publicly claimed the '1xBat' Asia Cup sponsorship was approved by the Asian Cricket Council — a claim disputed by the ACC.",
      "mohan→sumathipala": "REPORTED: Both attended ICC Board meetings together. Nature of coordination documented in multiple Sri Lankan media reports.",
      "slc→1xbet": "VERIFIED: '1xBat' (a rebrand of 1xBet to avoid Google ad policies) was the official sponsor of Sri Lanka's Asia Cup 2023 campaign. SLC Secretary Mohan de Silva confirmed the deal.",
      "slc→wolf777": "VERIFIED: Wolf777 appeared on the back of Sri Lanka's national team jersey during the 2022 India tour. Jersey images widely circulated. Wolf777 owner Rakesh Rajdev is wanted by Indian police.",
      "slc→skyfair": "VERIFIED: Skyfair was LPL 2023 title sponsor. Justice Minister Wijedasa Rajapaksa named it as an 'illegal offshore betting website' in Parliament in August 2023.",
      "slc→kheloyar": "VERIFIED: Kheloyar sponsored LPL teams. The Mahadev Book network behind Kheloyar was operated in partnership with D-Company (Dawood Ibrahim's criminal network).",
      "slc→crickex": "VERIFIED: Crickex sponsored LPL teams. Registered as VB Digital N.V. in Curaçao/Cyprus. Multiple consumer fraud complaints filed.",
      "slc→melbet": "VERIFIED: Melbet advertised across SLC's digital ecosystem, primarily through ThePapare (owned by Dialog, SLC's main sponsor). Indirect but undeniable commercial relationship.",
      "1xbet→melbet": "VERIFIED: Technical analysis shows Melbet shares the same IP infrastructure, odds feed, backend platform, and identical terms & conditions as 1xBet. Melbet is registered as Pelican Entertainment B.V. in Curaçao — a known 1xBet shell entity.",
      "1xbet→semiokhin": "VERIFIED: Roman Semiokhin is a confirmed 1xBet co-founder. Russian media and court filings identify him. He holds Cypriot citizenship and is on Russia's international wanted list for illegal gambling (63 billion rubles).",
      "1xbet→karshkov": "VERIFIED: Sergey Karshkov was a 1xBet co-founder and former head of Bryansk cybercrime unit. Died June 2023, age 42, from 'anaphylactic shock' during a routine Swiss medical exam. Circumstances widely considered suspicious.",
      "1xbet→curacao": "VERIFIED: 1xBet operates under Curaçao e-gaming licences through multiple shell companies.",
      "1xbet→cyprus": "VERIFIED: 1xBet's operational HQ is in Limassol, Cyprus. Payment processing entities (Edric Ltd, Faren Ltd) are Cyprus-registered.",
      "melbet→curacao": "VERIFIED: Melbet operates under Curaçao licence #134359 through Pelican Entertainment B.V.",
      "melbet→cyprus": "VERIFIED: Melbet's payment processing runs through Cyprus-registered entities shared with 1xBet.",
      "kheloyar→dawood": "VERIFIED by ED (Enforcement Directorate, India): Kheloyar was operated with Mustaqim Ibrahim Kaskar, brother of Dawood Ibrahim. Protection money was paid to D-Company. From official Indian law enforcement filings.",
      "kheloyar→chandrakar": "VERIFIED: Saurabh Chandrakar arrested in Dubai on Interpol Red Corner Notice (2024). ED confirmed he operated the Mahadev Book network processing ₹200 crore daily through 60+ betting apps.",
      "chandrakar→dubai": "VERIFIED: Chandrakar was arrested in Dubai based on Interpol Red Corner Notice issued at India's request.",
      "wolf777→rajdev": "VERIFIED: Ahmedabad Crime Branch and Nagpur police have issued lookout notices for Rakesh Rajdev. ED traced ₹170.70 crore through a single fraudulent bank account linked to Wolf777.",
      "wolf777→curacao": "VERIFIED: Wolf777 operates through GIT Operations N.V., registered in Curaçao.",
      "rajdev→dubai": "VERIFIED: Rajdev operates from Dubai, beyond Indian extradition reach. Multiple Indian law enforcement agencies have pending cases.",
      "stbet→curacao": "VERIFIED: STBet operates under Curaçao licence 8047/JAZ. Online extension of Sumathipala's legacy Sporting Star business.",
      "dialog→papare": "VERIFIED: Dialog Axiata owns ThePapare.com. Corporate records confirm full ownership.",
      "dialog→slc": "VERIFIED: Dialog has a $4.8M sponsorship deal with SLC AND holds ICC broadcast rights in Sri Lanka until 2028. Dual commercial relationship creates massive conflict of interest.",
      "dialog→icc": "VERIFIED: Dialog holds ICC broadcast rights in Sri Lanka until 2028.",
      "papare→melbet": "VERIFIED: Melbet display ads ran on ThePapare.com. Screenshots documented by multiple observers. Dialog claims these are 'programmatic' (automated) ads.",
      "ipg→slc": "VERIFIED: IPG (Dubai) holds LPL marketing, broadcast, franchise, and sponsorship rights since 2020. They control which sponsors appear on team jerseys.",
      "ipg→dubai": "VERIFIED: IPG is Dubai-based, placing it beyond Sri Lankan jurisdiction for accountability.",
      "wickremesinghe→shammi": "VERIFIED: When Sports Minister Ranasinghe dissolved the SLC board, President Wickremesinghe fired Ranasinghe from ALL ministries and effectively reinstated the Silva-led board.",
      "wickremesinghe→ranasinghe": "VERIFIED: Wickremesinghe fired Ranasinghe from all ministerial positions after he dissolved SLC board and called Silva 'Betting Shammi.' Widely reported in all Sri Lankan media.",
      "wickremesinghe→harin": "VERIFIED: Harin Fernando was appointed as replacement Sports Minister after Ranasinghe's firing.",
      "ranasinghe→shammi": "VERIFIED: Ranasinghe dissolved the SLC board and publicly called Silva 'Betting Shammi' in Parliament. Parliamentary Hansard records exist.",
      "harin→sumathipala": "VERIFIED: During his 2018-19 tenure, Fernando successfully pushed for Sumathipala's ban from SLC office, working with ICC.",
      "harin→shammi": "PARTIALLY VERIFIED: Fernando restored the Silva board after being appointed following Ranasinghe's removal. Whether this was pragmatic (avoiding ICC suspension) or accommodating is debated.",
      "harin→icc": "VERIFIED: Fernando negotiated with ICC to lift SLC's suspension by meeting their conditions for governance reforms.",
      "harin→jayasundara": "VERIFIED: Fernando reported a bribery attempt by SLC analyst Jayasundara to the ICC ACU. Jayasundara was subsequently charged and banned.",
      "wijedasa→skyfair": "VERIFIED: Justice Minister Wijedasa Rajapaksa named Skyfair and 14 other illegal betting sites sponsoring LPL in a Parliamentary speech, August 2023. Hansard records exist. No legal action followed.",
      "dissanayake→slc": "VERIFIED: The NPP government passed the Gaming Regulatory Authority Act 2025 and raised gaming tax to 45%. GRA expected operational by June 2026.",
      "icc→slc": "VERIFIED: ICC suspended SLC for 'government interference' when Ranasinghe tried to clean up. ACU had 22 live investigations into Sri Lankan cricket corruption.",
      "marshall→icc": "VERIFIED: Alex Marshall served as ICC ACU General Manager before retirement. He deployed Steve Richardson to Colombo for investigations.",
      "marshall→slc": "VERIFIED: Marshall briefed the Sri Lankan President and PM on the depth of corruption in Sri Lankan cricket.",
      "watson→melbet": "VERIFIED: Shane Watson served as Melbet's global brand ambassador (2021 campaign). Promotional materials widely available.",
      "watson→wolf777": "VERIFIED: Watson also endorsed Wolf777 (2023). Same person endorsing TWO illegal betting platforms targeting overlapping markets.",
      "raina→1xbet": "VERIFIED: ED (Enforcement Directorate) attached ₹6.64 crore of Raina's mutual fund holdings. Raina allegedly 'knowingly' signed endorsement deals with 1xBet foreign entities.",
      "dhawan→1xbet": "VERIFIED: ED attached ₹4.5 crore in Dhawan's immovable property linked to 1xBet endorsement earnings.",
      "yuvraj→1xbet": "VERIFIED: ED attached ₹2.5 crore via YWC Health and Wellness Pvt. Ltd., a company linked to Yuvraj Singh.",
      "uthappa→crickex": "VERIFIED: Robin Uthappa has been Crickex's brand ambassador. Promotional videos and social media posts confirm.",
      "uthappa→1xbet": "REPORTED: Uthappa also endorsed 1xBet. ED attached ₹8.26 lakh in his assets.",
      "pollard→1xbet": "VERIFIED: Kieron Pollard signed a 2-year deal as 1xBet India ambassador. Featured on Delhi billboards and auto-rickshaw wraps.",
      "bravo→1xbet": "VERIFIED: Dwayne Bravo was the FIRST 1xBet brand ambassador in India (September 2021). Full-page Times of India advertisements documented.",
      "iniesta→melbet": "VERIFIED: Andrés Iniesta served as Melbet global ambassador in 'The Greatest 8' campaign.",
      "babar→kheloyar": "VERIFIED: Babar Azam refused to wear Kheloyar logo on Colombo Strikers jersey during LPL. Appeared in a blank jersey. Added 'no betting company' clause to all contracts.",
      "rahman→slc": "VERIFIED: Tamim Rahman, Dambulla Thunders owner, pled guilty January 2026. 4-year suspended sentence + LKR 24M fine. First LPL franchise owner convicted.",
      "senanayake→slc": "VERIFIED: Sachithra Senanayake indicted June 2025 — first criminal prosecution of a Sri Lankan cricketer for match-fixing. Accused of approaching a player via WhatsApp during LPL 2020.",
      "jayasuriya→slc": "VERIFIED: Sanath Jayasuriya received a 2-year ICC ban (2019) for refusing to cooperate with ACU anti-corruption investigation.",
      "crickex→curacao": "VERIFIED: Crickex operates through VB Digital N.V., registered in Curaçao.",
      "skyfair→curacao": "VERIFIED: Skyfair operates through Sky Infotech N.V., Curaçao #152377."
    };

    // ============ EXPANDED DATA — visible only when showExpanded=true ============
    const expandedNodes = [
      { id:"lpl",           label:"Lanka Premier League",    type:"corporate",  size:18, desc:"Sri Lanka T20 franchise league — all 6 teams carried illegal offshore betting logos during 2022–23 seasons.",                              tags:["lpl","cricket","tournament"],          expanded:true },
      { id:"dambulla",      label:"Dambulla Thunders",       type:"corporate",  size:14, desc:"LPL franchise owned by Tamim Rahman, who pleaded guilty to match-fixing and betting-related offences.",                                    tags:["lpl-franchise","convicted"],           expanded:true },
      { id:"colombo_kings", label:"Colombo Kings",           type:"corporate",  size:14, desc:"LPL franchise — Melbet served as main shirt sponsor during the 2022 season.",                                                              tags:["lpl-franchise"],                       expanded:true },
      { id:"mahadev",       label:"Mahadev Book",            type:"betting",    size:16, desc:"India's most-investigated illegal betting network — linked to SL cricketers via backend infrastructure shared with Kheloyar.",              tags:["india","ed-investigated","illegal"],    expanded:true },
      { id:"molfar",        label:"Molfar Network",          type:"corporate",  size:12, desc:"OSINT-confirmed IP infrastructure layer with overlap across 1xBet-affiliated operators in South Asia.",                                    tags:["technical","osint"],                   expanded:true },
      { id:"india_ed",      label:"India ED",                type:"government", size:16, desc:"India Enforcement Directorate — attached ₹19cr+ in assets from SL-linked cricketers endorsing illegal offshore platforms.",               tags:["law-enforcement","india"],             expanded:true },
      { id:"zoysa",         label:"Nuwan Zoysa",             type:"convicted",  size:14, desc:"Former SL fast bowler — ICC 6-year ban (2018) for approaching active players on behalf of a match-fixer during an ICC event.",             tags:["convicted","match-fixing","cricketer"], expanded:true },
      { id:"lokuhettige",   label:"Dilhara Lokuhettige",     type:"convicted",  size:14, desc:"Former SL spinner — ICC 8-year ban (2019) for three counts of match-fixing including approaches during Champions League T20.",              tags:["convicted","match-fixing","cricketer"], expanded:true },
      { id:"tharanga",      label:"Upul Tharanga",           type:"slc",        size:12, desc:"Former SL ODI captain — suspended pending ICC ACU investigation into alleged contacts with illegal bookmakers.",                           tags:["cricketer","suspended"],               expanded:true },
      { id:"shanaka",       label:"Dasun Shanaka",           type:"slc",        size:12, desc:"SL national team captain during T20 WC 2026 Super 8s — under post-match integrity scrutiny after shock elimination.",                      tags:["captain","cricketer"],                 expanded:true },
      { id:"mustaqim",      label:"Mustaqim Kaskar",         type:"criminal",   size:14, desc:"Identified D-Company associate — linked by investigators to Kheloyar's South Asia operations and financial flows.",                        tags:["d-company","associate"],               expanded:true },
      { id:"jayarathne",    label:"Jerome Jayarathne",       type:"slc",        size:12, desc:"SLC executive committee member — suspended as part of board-wide investigations covering 22+ active corruption cases.",                    tags:["slc-official","suspended"],            expanded:true },
      { id:"galle_fix",     label:"Galle Pitch-Fixing",      type:"convicted",  size:12, desc:"2000s pitch-fixing scandal at Galle — the earliest modern marker of systemic vulnerability within Sri Lanka Cricket.",                    tags:["historical","match-fixing"],           expanded:true },
    ];

    const expandedLinks = [
      // LPL ecosystem
      { source:"lpl",           target:"slc",          type:"solid",  strength:5, label:"Governed under SLC franchise system"       },
      { source:"lpl",           target:"stbet",        type:"solid",  strength:4, label:"LPL title sponsor 2023"                    },
      { source:"lpl",           target:"melbet",       type:"solid",  strength:4, label:"Multi-team shirt sponsor 2022–23"           },
      { source:"lpl",           target:"onexbet",      type:"solid",  strength:4, label:"1xBat logo on all 6 franchises"            },
      { source:"dambulla",      target:"lpl",          type:"solid",  strength:4, label:"LPL franchise"                             },
      { source:"dambulla",      target:"tamim",        type:"solid",  strength:5, label:"Owner convicted of betting offences"        },
      { source:"colombo_kings", target:"lpl",          type:"solid",  strength:4, label:"LPL franchise"                             },
      { source:"colombo_kings", target:"melbet",       type:"solid",  strength:4, label:"Main shirt sponsor"                        },
      // Mahadev / India ED nexus
      { source:"mahadev",       target:"kheloyar",     type:"dashed", strength:3, label:"Shared backend infrastructure (ED)"        },
      { source:"mahadev",       target:"india_ed",     type:"solid",  strength:5, label:"Primary ED investigation target"           },
      { source:"india_ed",      target:"yuvraj",       type:"solid",  strength:4, label:"₹6.64cr assets attached"                  },
      { source:"india_ed",      target:"dhawan",       type:"solid",  strength:4, label:"₹4.5cr assets attached"                   },
      { source:"india_ed",      target:"uthappa",      type:"solid",  strength:4, label:"₹2.5cr assets attached"                   },
      { source:"india_ed",      target:"onexbet",      type:"solid",  strength:3, label:"Platform under ED jurisdiction"            },
      // Infrastructure
      { source:"molfar",        target:"onexbet",      type:"dashed", strength:3, label:"IP overlap confirmed by OSINT"             },
      // D-Company link
      { source:"mustaqim",      target:"dawood",       type:"solid",  strength:5, label:"D-Company associate (confirmed)"           },
      { source:"mustaqim",      target:"kheloyar",     type:"dashed", strength:3, label:"Linked to Kheloyar operations"             },
      // Convicted cricketers
      { source:"zoysa",         target:"icc",          type:"solid",  strength:5, label:"6-year ban — match-fixing approach"        },
      { source:"zoysa",         target:"slc",          type:"solid",  strength:4, label:"Approached active SLC players as fixer"    },
      { source:"lokuhettige",   target:"icc",          type:"solid",  strength:5, label:"8-year ban — three counts match-fixing"    },
      { source:"lokuhettige",   target:"galle_fix",    type:"solid",  strength:3, label:"Part of Galle-era fixing network"          },
      // Others
      { source:"tharanga",      target:"slc",          type:"solid",  strength:4, label:"Former ODI captain — ACU suspended"        },
      { source:"tharanga",      target:"icc",          type:"solid",  strength:3, label:"ICC ACU investigation pending"             },
      { source:"shanaka",       target:"slc",          type:"solid",  strength:4, label:"National team captain 2022–25"             },
      { source:"jayarathne",    target:"slc",          type:"solid",  strength:4, label:"Executive — suspended / 22+ cases"         },
      { source:"galle_fix",     target:"slc",          type:"solid",  strength:4, label:"First major SLC integrity failure"         },
    ];

    // Merge into main arrays before resolve-links step
    nodes.push(...expandedNodes);
    links.push(...expandedLinks);

    // Expanded link facts
    Object.assign(linkFacts, {
      "lpl→slc":                "VERIFIED: Lanka Premier League franchises operate under Sri Lanka Cricket's governance structure. SLC controls broadcasting rights, franchise licensing, and player availability contracts.",
      "lpl→stbet":              "VERIFIED: STBet (Sumathipala-linked entity) was named LPL title sponsor for the 2023 season, creating a direct conflict of interest with the SLC chairman.",
      "lpl→melbet":             "VERIFIED: Melbet sponsored multiple LPL team jerseys during 2022–23 seasons despite being classified as an unlicensed offshore operator in Sri Lanka.",
      "lpl→onexbet":            "VERIFIED: The 1xBat logo (1xBet sub-brand) appeared across all 6 LPL franchise team jerseys during the 2022 season — the most pervasive single-operator penetration in the tournament.",
      "dambulla→lpl":           "VERIFIED: Dambulla Thunders is one of the original six Lanka Premier League franchises.",
      "dambulla→tamim":         "VERIFIED: Tamim Rahman owned the Dambulla Thunders franchise and pleaded guilty to match-fixing and illegal betting offences — the first LPL franchise owner to be convicted.",
      "colombo_kings→lpl":      "VERIFIED: Colombo Kings is one of the six LPL franchise teams.",
      "colombo_kings→melbet":   "VERIFIED: Melbet was the main shirt sponsor of Colombo Kings during the LPL 2022 season.",
      "mahadev→kheloyar":       "REPORTED: India Enforcement Directorate investigation documents note shared technical infrastructure between Mahadev Book and Kheloyar's South Asia operations.",
      "mahadev→india_ed":       "VERIFIED: The Mahadev Book betting network is the primary target of India's ED multi-state crackdown. Multiple operators have been arrested and assets attached.",
      "india_ed→yuvraj":        "VERIFIED: India ED attached ₹6.64 crore in assets from Yuvraj Singh linked to endorsement contracts with a 1xBet-affiliated platform.",
      "india_ed→dhawan":        "VERIFIED: India ED attached ₹4.5 crore in assets from Shikhar Dhawan linked to an affiliated offshore betting platform.",
      "india_ed→uthappa":       "VERIFIED: India ED attached ₹2.5 crore in assets from Robin Uthappa linked to endorsement of an offshore gambling operator.",
      "india_ed→onexbet":       "VERIFIED: 1xBet and its affiliate platforms are under active India ED jurisdiction, with multiple assets attached across promotional networks.",
      "molfar→onexbet":         "PARTIALLY VERIFIED: OSINT analysis by Molfar confirmed IP address and infrastructure overlaps between 1xBet-branded operations and affiliated operators across South Asia.",
      "mustaqim→dawood":        "VERIFIED: Mustaqim Ibrahim Kaskar is an identified associate of the Dawood Ibrahim D-Company criminal network, confirmed in law enforcement documentation.",
      "mustaqim→kheloyar":      "REPORTED: Investigators have linked Mustaqim Kaskar to financial flows connected to Kheloyar's South Asia betting operations.",
      "zoysa→icc":              "VERIFIED: ICC handed Nuwan Zoysa a 6-year ban in 2018 for approaching an undercover operative and attempting to fix aspects of a match on behalf of a named fixer.",
      "zoysa→slc":              "VERIFIED: Zoysa used his access as a former SLC-contracted player to approach active national squad members on behalf of match-fixers.",
      "lokuhettige→icc":        "VERIFIED: ICC banned Dilhara Lokuhettige for 8 years in 2019 following three proven counts of match-fixing including approaches during the Champions League T20.",
      "lokuhettige→galle_fix":  "PARTIALLY VERIFIED: Lokuhettige's connections trace back to the broader Galle-era fixing network that first exposed systemic vulnerabilities in SLC.",
      "tharanga→slc":           "VERIFIED: Upul Tharanga served as Sri Lanka ODI captain and was suspended by Sri Lanka Cricket pending an ICC ACU investigation.",
      "tharanga→icc":           "VERIFIED: ICC ACU opened formal investigation into Upul Tharanga following intelligence about alleged contacts with illegal bookmakers.",
      "shanaka→slc":            "VERIFIED: Dasun Shanaka captained the Sri Lanka national team from 2022, including the T20 World Cup 2026 campaign that ended in Super 8s elimination.",
      "jayarathne→slc":         "VERIFIED: Jerome Jayarathne served on the SLC executive committee and was among officials suspended as part of board-wide investigations into 22+ corruption cases.",
      "galle_fix→slc":          "VERIFIED: The Galle pitch-fixing scandal of the early 2000s was the first major documented case of systemic integrity failure within Sri Lanka Cricket, establishing patterns that persisted for two decades.",
    });

        // ============ STATE ============
    let panX = window.innerWidth / 2;
    let panY = window.innerHeight / 2;
    let scale = 1;
    let dragging = null;
    let dragStartX = 0;
    let dragStartY = 0;
    let dragStartNodeX = 0;
    let dragStartNodeY = 0;
    let panDragStartX = 0;
    let panDragStartY = 0;
    let tick = 0;
    const maxTicks = 500;
    let visibleTypes = new Set(Object.keys(typeColors));
    let selectedLink = null;
    let showExpanded = false;

    // ============ RESOLVE LINKS ============
    const nodeMap = {};
    nodes.forEach(n => nodeMap[n.id] = n);

    links.forEach(l => {
      l.source = nodeMap[l.source];
      l.target = nodeMap[l.target];
    });

    // ============ SVG SETUP ============
    const svg = document.getElementById('map');
    const canvas = document.getElementById('canvas');
    const linksLayer = document.getElementById('links-layer');
    const nodesLayer = document.getElementById('nodes-layer');

    // ============ INITIALIZE NODES — type-clustered positions ============
    // Nodes live in SVG space: (0,0) = screen centre (canvas group translates by panX/panY)
    const clusterAngles = {
      slc:         0,
      betting:     Math.PI * 0.25,
      criminal:    Math.PI * 0.5,
      convicted:   Math.PI * 0.75,
      jurisdiction: Math.PI,
      government:  Math.PI * 1.25,
      corporate:   Math.PI * 1.5,
      celebrity:   Math.PI * 1.75
    };

    // Seeded LCG — deterministic layout on every load
    let _seed = 42;
    function seededRand() {
      _seed = (_seed * 1664525 + 1013904223) & 0xFFFFFFFF;
      return (_seed >>> 0) / 0xFFFFFFFF;
    }

    nodes.forEach(n => {
      const baseAngle = (clusterAngles[n.type] !== undefined) ? clusterAngles[n.type] : 0;
      const jitter    = (seededRand() - 0.5) * Math.PI * 0.45;
      const angle     = baseAngle + jitter;
      const r         = 140 + seededRand() * 160;   // 140–300 px from centre
      n.x  = Math.cos(angle) * r;
      n.y  = Math.sin(angle) * r;
      n.vx = 0;
      n.vy = 0;
      // Pre-compute dashed-link flag once (links are static)
      n._hasDashedLink = links.some(l =>
        (l.source === n || l.target === n) && l.type === "dashed"
      );
    });

    // ============ INIT ELEMENTS — create all SVG elements once, store refs ============
    function initElements() {
      // --- Links ---
      links.forEach(link => {
        // Invisible hit target (wider, easier to click)
        const hitLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
        hitLine.setAttribute("stroke", "transparent");
        hitLine.setAttribute("stroke-width", "12");
        hitLine.style.cursor = "pointer";
        hitLine.addEventListener('click', (e) => showLinkPopup(e, link));
        link._hit = hitLine;
        linksLayer.appendChild(hitLine);

        // Visible line
        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.setAttribute("stroke", typeColors[link.source.type]);
        line.setAttribute("stroke-width", String(Math.max(link.strength * 0.7, 0.8)));
        if (link.type === "dashed") line.setAttribute("stroke-dasharray", "6,4");
        line.style.transition = "stroke 0.2s";
        line.addEventListener('mouseenter', () => line.setAttribute("stroke", "#ffd700"));
        line.addEventListener('mouseleave', () => line.setAttribute("stroke", typeColors[link.source.type]));
        link._line = line;
        linksLayer.appendChild(line);
      });

      // --- Nodes ---
      nodes.forEach(node => {
        const g = document.createElementNS("http://www.w3.org/2000/svg", "g");

        // Shadow glow
        const shadow = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        shadow.setAttribute("r", String(node.size));
        shadow.setAttribute("fill", typeColors[node.type]);
        shadow.setAttribute("opacity", "0.15");
        shadow.setAttribute("filter", "url(#glow)");
        node._shadow = shadow;
        g.appendChild(shadow);

        // Main circle
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("r", String(node.size));
        circle.setAttribute("fill", typeColors[node.type]);
        circle.setAttribute("filter", "url(#glow)");
        circle.style.cursor = "grab";
        node._circle = circle;
        g.appendChild(circle);

        // Bottom shadow — darkens lower hemisphere for depth
        const sphereShadow = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        sphereShadow.setAttribute("r", String(node.size));
        sphereShadow.setAttribute("fill", "url(#sphere-shadow)");
        sphereShadow.style.pointerEvents = "none";
        node._sphereShadow = sphereShadow;
        g.appendChild(sphereShadow);

        // Specular highlight — bright top-left spot for 3D sphere look
        const specular = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        specular.setAttribute("r", String(node.size));
        specular.setAttribute("fill", "url(#specular)");
        specular.style.pointerEvents = "none";
        node._specular = specular;
        g.appendChild(specular);

        // Convicted pulse ring
        if (node.tags.includes("convicted")) {
          const pulse = document.createElementNS("http://www.w3.org/2000/svg", "circle");
          pulse.setAttribute("r", String(node.size));
          pulse.setAttribute("fill", "none");
          pulse.setAttribute("stroke", "#ff2266");
          pulse.setAttribute("stroke-width", "2");
          pulse.classList.add("convicted-pulse");
          node._pulse = pulse;
          g.appendChild(pulse);
        }

        // Dashed link indicator ring
        if (node._hasDashedLink) {
          const dashedRing = document.createElementNS("http://www.w3.org/2000/svg", "circle");
          dashedRing.setAttribute("r", String(node.size + 6));
          dashedRing.setAttribute("fill", "none");
          dashedRing.setAttribute("stroke", "#ff9900");
          dashedRing.setAttribute("stroke-width", "2");
          dashedRing.setAttribute("stroke-dasharray", "4,3");
          node._dashedRing = dashedRing;
          g.appendChild(dashedRing);
        }

        // Convicted badge (! icon, top-right)
        if (node.tags.includes("convicted")) {
          const b = document.createElementNS("http://www.w3.org/2000/svg", "circle");
          b.setAttribute("r", "6");
          b.setAttribute("fill", "#ff2266");
          node._badge1 = b;
          g.appendChild(b);

          const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
          t.setAttribute("text-anchor", "middle");
          t.setAttribute("dominant-baseline", "central");
          t.setAttribute("font-size", "8");
          t.setAttribute("font-weight", "bold");
          t.setAttribute("fill", "#fff");
          t.textContent = "!";
          node._badge1t = t;
          g.appendChild(t);
        }

        // Dashed link badge (? icon, top-right)
        if (node._hasDashedLink) {
          node._badge2offsetX = node.tags.includes("convicted") ? -15 : 0;
          const b = document.createElementNS("http://www.w3.org/2000/svg", "circle");
          b.setAttribute("r", "6");
          b.setAttribute("fill", "#ff9900");
          node._badge2 = b;
          g.appendChild(b);

          const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
          t.setAttribute("text-anchor", "middle");
          t.setAttribute("dominant-baseline", "central");
          t.setAttribute("font-size", "8");
          t.setAttribute("font-weight", "bold");
          t.setAttribute("fill", "#fff");
          t.textContent = "?";
          node._badge2t = t;
          g.appendChild(t);
        }

        // Node label (below circle)
        const labelText = document.createElementNS("http://www.w3.org/2000/svg", "text");
        const display = node.label.length > 22 ? node.label.slice(0, 20) + '…' : node.label;
        labelText.textContent = display;
        labelText.setAttribute("text-anchor", "middle");
        labelText.setAttribute("dominant-baseline", "hanging");
        labelText.setAttribute("font-size", "9.5");
        labelText.setAttribute("font-family", "Inter, system-ui, sans-serif");
        labelText.setAttribute("fill", "#e0e0e0");
        labelText.setAttribute("stroke", "#0a0a0f");
        labelText.setAttribute("stroke-width", "3");
        labelText.setAttribute("paint-order", "stroke fill");
        labelText.style.pointerEvents = "none";
        node._label = labelText;
        g.appendChild(labelText);

        // Events
        circle.addEventListener('mousedown', (e) => startNodeDrag(e, node));
        circle.addEventListener('click', (e) => {
          if (dragDistance < 5) showNodePopup(e, node);
        });

        node._group = g;
        nodesLayer.appendChild(g);
      });
    }

    // ============ UPDATE POSITIONS — set attributes only, no DOM destruction ============
    function updatePositions() {
      links.forEach(link => {
        const isExp = (link.source.expanded || link.target.expanded);
        const visible = visibleTypes.has(link.source.type) && visibleTypes.has(link.target.type) && (!isExp || showExpanded);
        const disp = visible ? '' : 'none';
        if (link._hit.style.display !== disp)  link._hit.style.display  = disp;
        if (link._line.style.display !== disp) link._line.style.display = disp;
        if (visible) {
          link._hit.setAttribute("x1",  String(link.source.x));
          link._hit.setAttribute("y1",  String(link.source.y));
          link._hit.setAttribute("x2",  String(link.target.x));
          link._hit.setAttribute("y2",  String(link.target.y));
          link._line.setAttribute("x1", String(link.source.x));
          link._line.setAttribute("y1", String(link.source.y));
          link._line.setAttribute("x2", String(link.target.x));
          link._line.setAttribute("y2", String(link.target.y));
        }
      });

      nodes.forEach(node => {
        const visible = visibleTypes.has(node.type) && (!node.expanded || showExpanded);
        node._group.style.display = visible ? '' : 'none';
        if (!visible) return;

        const x = node.x, y = node.y;
        node._shadow.setAttribute("cx", String(x));
        node._shadow.setAttribute("cy", String(y));
        node._circle.setAttribute("cx", String(x));
        node._circle.setAttribute("cy", String(y));
        if (node._sphereShadow) { node._sphereShadow.setAttribute("cx", String(x)); node._sphereShadow.setAttribute("cy", String(y)); }
        if (node._specular)     { node._specular.setAttribute("cx",     String(x)); node._specular.setAttribute("cy",     String(y)); }
        if (node._pulse)      { node._pulse.setAttribute("cx",      String(x)); node._pulse.setAttribute("cy",      String(y)); }
        if (node._dashedRing) { node._dashedRing.setAttribute("cx", String(x)); node._dashedRing.setAttribute("cy", String(y)); }

        // Badges track top-right of circle
        const bx = x + (node.size - 8);
        const by = y - (node.size - 8);
        if (node._badge1)  { node._badge1.setAttribute("cx", String(bx));  node._badge1.setAttribute("cy",  String(by)); }
        if (node._badge1t) { node._badge1t.setAttribute("x", String(bx));  node._badge1t.setAttribute("y",  String(by)); }
        if (node._badge2)  { node._badge2.setAttribute("cx",  String(bx + node._badge2offsetX)); node._badge2.setAttribute("cy",  String(by)); }
        if (node._badge2t) { node._badge2t.setAttribute("x",  String(bx + node._badge2offsetX)); node._badge2t.setAttribute("y",  String(by)); }

        // Label sits just below the circle
        if (node._label) {
          node._label.setAttribute("x", String(x));
          node._label.setAttribute("y", String(y + node.size + 5));
        }
      });

      canvas.setAttribute("transform", `translate(${panX},${panY}) scale(${scale})`);
    }

    // ============ FORCE SIMULATION — inverse-square repulsion + variable spring lengths ============
    function simulate(alpha) {
      nodes.forEach(n => {
        if (dragging === n) return;
        if (n.expanded && !showExpanded) return;

        let fx = 0, fy = 0;

        // Gentle centre gravity — pulls toward origin (0,0) in SVG space
        fx += -n.x * 0.004 * alpha;
        fy += -n.y * 0.004 * alpha;

        // Link springs — ideal length varies with connection strength
        links.forEach(l => {
          if (l.source !== n && l.target !== n) return;
          const other = l.source === n ? l.target : l.source;
          if (!visibleTypes.has(other.type) || !visibleTypes.has(n.type)) return;
          const dx   = other.x - n.x;
          const dy   = other.y - n.y;
          const dist = Math.sqrt(dx * dx + dy * dy) || 1;
          // strength 5 → ideal 130px  |  strength 1 → ideal 330px
          const ideal = 80 + (6 - l.strength) * 50;
          const force = (dist - ideal) * 0.004 * alpha;
          fx += (dx / dist) * force;
          fy += (dy / dist) * force;
        });

        // Node repulsion — inverse-square, charge scales with node size
        nodes.forEach(other => {
          if (other === n) return;
          if (other.expanded && !showExpanded) return;
          if (!visibleTypes.has(other.type) || !visibleTypes.has(n.type)) return;
          const dx     = n.x - other.x;
          const dy     = n.y - other.y;
          const distSq = dx * dx + dy * dy || 1;
          const dist   = Math.sqrt(distSq);
          if (dist < 380) {
            const charge = (n.size + other.size) * 180;
            const force  = Math.min(charge / distSq, 6) * alpha;
            fx += (dx / dist) * force;
            fy += (dy / dist) * force;
          }
        });

        n.vx = (n.vx + fx) * 0.82;
        n.vy = (n.vy + fy) * 0.82;
        n.x += n.vx;
        n.y += n.vy;
      });
    }

    // ============ ANIMATION LOOP — alpha cooling (~200 ticks to settle) ============
    let alpha = 1.0;
    const ALPHA_DECAY = 0.005;
    const MIN_ALPHA   = 0.001;

    function animate() {
      if (alpha > MIN_ALPHA) {
        simulate(alpha);
        alpha = Math.max(alpha - ALPHA_DECAY, 0);
      } else if (dragging) {
        // Keep simulation responsive while dragging after cooldown
        simulate(0.08);
      }
      updatePositions();
      requestAnimationFrame(animate);
    }

    initElements();
    animate();

    // ============ DRAG STATE ============
    let dragDistance = 0;

    function startNodeDrag(e, node) {
      dragging = node;
      alpha = Math.max(alpha, 0.4);  // reheat so other nodes respond to the drag
      dragStartX = e.clientX;
      dragStartY = e.clientY;
      dragStartNodeX = node.x;
      dragStartNodeY = node.y;
      dragDistance = 0;
    }

    // ============ INTERACTIONS ============
    svg.addEventListener('mousemove', (e) => {
      if (dragging) {
        const dx = e.clientX - dragStartX;
        const dy = e.clientY - dragStartY;
        dragDistance = Math.sqrt(dx * dx + dy * dy);
        dragging.x = dragStartNodeX + dx / scale;
        dragging.y = dragStartNodeY + dy / scale;
      }
    });

    svg.addEventListener('mouseup', () => {
      dragging = null;
    });

    svg.addEventListener('mousedown', (e) => {
      if (e.target.tagName !== 'circle' && !e.target.closest('line')) {
        panDragStartX = e.clientX;
        panDragStartY = e.clientY;
        const oldPanX = panX;
        const oldPanY = panY;
        const move = (moveE) => {
          panX = oldPanX + (moveE.clientX - panDragStartX);
          panY = oldPanY + (moveE.clientY - panDragStartY);
        };
        const endPan = () => {
          svg.removeEventListener('mousemove', move);
          svg.removeEventListener('mouseup', endPan);
        };
        svg.addEventListener('mousemove', move);
        svg.addEventListener('mouseup', endPan);
      }
    });

    svg.addEventListener('wheel', (e) => {
      e.preventDefault();
      const zoomSpeed = 0.1;
      const oldScale = scale;
      scale += (e.deltaY > 0 ? -1 : 1) * zoomSpeed * scale;
      scale = Math.max(0.1, Math.min(3, scale));

      // Zoom toward mouse
      const mouseX = (e.clientX - panX) / oldScale;
      const mouseY = (e.clientY - panY) / oldScale;
      panX -= mouseX * (scale - oldScale);
      panY -= mouseY * (scale - oldScale);
    });

    // ============ POPUPS ============
    function showNodePopup(e, node) {
      const popup = document.getElementById('node-popup');
      document.getElementById('popup-label').textContent = node.label;
      document.getElementById('popup-desc').textContent = node.desc;
      const tagsDiv = document.getElementById('popup-tags');
      tagsDiv.innerHTML = '';
      node.tags.forEach(tag => {
        const tagEl = document.createElement('div');
        tagEl.className = 'popup-tag';
        tagEl.textContent = tag;
        tagsDiv.appendChild(tagEl);
      });

      let x = e.clientX + 20;
      let y = e.clientY - 10;
      if (x + 340 > window.innerWidth) x = window.innerWidth - 360;
      if (y + 300 > window.innerHeight) y = window.innerHeight - 320;
      x = Math.max(10, x);
      y = Math.max(10, y);

      popup.style.left = x + 'px';
      popup.style.top = y + 'px';
      popup.classList.add('visible');
    }

    function showLinkPopup(e, link) {
      const key = link.source.id + '→' + link.target.id;
      const fact = linkFacts[key] || 'No fact available.';

      // Parse fact
      let label = '';
      let factText = fact;
      if (fact.startsWith('VERIFIED:')) {
        label = 'VERIFIED';
        factText = fact.substring('VERIFIED:'.length).trim();
      } else if (fact.startsWith('REPORTED:')) {
        label = 'REPORTED';
        factText = fact.substring('REPORTED:'.length).trim();
      } else if (fact.startsWith('PARTIALLY VERIFIED:')) {
        label = 'PARTIALLY VERIFIED';
        factText = fact.substring('PARTIALLY VERIFIED:'.length).trim();
      }

      const popup = document.getElementById('link-popup');
      const header = document.getElementById('popup-fact-header');
      header.innerHTML = `${link.source.label} → ${link.target.label}<br>`;
      const labelEl = document.createElement('span');
      labelEl.className = 'fact-label ' + (label === 'VERIFIED' ? 'verified' : label === 'REPORTED' ? 'reported' : 'partially');
      labelEl.textContent = label;
      header.appendChild(labelEl);

      document.getElementById('popup-fact-text').textContent = factText;

      let x = e.clientX + 20;
      let y = e.clientY - 10;
      if (x + 340 > window.innerWidth) x = window.innerWidth - 360;
      if (y + 300 > window.innerHeight) y = window.innerHeight - 320;
      x = Math.max(10, x);
      y = Math.max(10, y);

      popup.style.left = x + 'px';
      popup.style.top = y + 'px';
      popup.classList.add('visible');
    }

    function closePopups() {
      document.getElementById('node-popup').classList.remove('visible');
      document.getElementById('link-popup').classList.remove('visible');
    }

    document.querySelectorAll('.popup-close').forEach(btn => {
      btn.addEventListener('click', closePopups);
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closePopups();
    });

    document.addEventListener('click', (e) => {
      if (!e.target.closest('#node-popup') && !e.target.closest('#link-popup') && e.target.tagName !== 'circle' && !e.target.closest('line')) {
        closePopups();
      }
    });

    // ============ EXPAND TOGGLE ============
    function toggleExpanded() {
      showExpanded = !showExpanded;
      const btn = document.getElementById('expand-toggle');
      const count = document.getElementById('node-count');
      if (showExpanded) {
        btn.textContent = '⊖ Core View';
        btn.style.borderColor = 'rgba(255,200,50,0.7)';
        btn.style.color = '#ffc832';
        count.textContent = (nodes.length) + ' nodes · ' + (links.length) + ' links';
        alpha = Math.max(alpha, 0.6);  // reheat so new nodes find their places
      } else {
        btn.textContent = '⊕ Expanded';
        btn.style.borderColor = 'rgba(255,255,255,0.3)';
        btn.style.color = '#e0e0e0';
        count.textContent = '43 nodes · 62 links';
        alpha = Math.max(alpha, 0.4);  // gentle reheat so core re-settles
      }
    }

        // ============ LEGEND ============
    const legend = document.getElementById('legend');
    const legendTitle = legend.querySelector('.legend-title');

    // Select / Deselect All control
    legendTitle.insertAdjacentHTML('afterend', `
      <div style="display:flex;gap:6px;margin-bottom:8px;">
        <button id="sel-all" style="flex:1;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.2);color:#ccc;font-size:10px;font-family:inherit;padding:3px 0;border-radius:6px;cursor:pointer;" onmouseover="this.style.background='rgba(255,255,255,0.15)'" onmouseout="this.style.background='rgba(255,255,255,0.08)'">Select All</button>
        <button id="desel-all" style="flex:1;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.2);color:#ccc;font-size:10px;font-family:inherit;padding:3px 0;border-radius:6px;cursor:pointer;" onmouseover="this.style.background='rgba(255,255,255,0.15)'" onmouseout="this.style.background='rgba(255,255,255,0.08)'">Deselect All</button>
      </div>
    `);

    legendTitle.insertAdjacentHTML('afterend',
      Object.entries(typeColors).map(([type, color]) => {
        return `
          <div class="legend-item">
            <input type="checkbox" checked data-type="${type}" id="check-${type}">
            <div class="legend-swatch" style="background-color: ${color};"></div>
            <label for="check-${type}" style="cursor: pointer;">${type}</label>
          </div>
        `;
      }).join('')
    );

    legend.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
      checkbox.addEventListener('change', () => {
        const type = checkbox.getAttribute('data-type');
        if (checkbox.checked) {
          visibleTypes.add(type);
        } else {
          visibleTypes.delete(type);
        }
      });
    });

    document.getElementById('sel-all').addEventListener('click', () => {
      legend.querySelectorAll('input[type="checkbox"]').forEach(cb => {
        cb.checked = true;
        visibleTypes.add(cb.getAttribute('data-type'));
      });
    });

    document.getElementById('desel-all').addEventListener('click', () => {
      legend.querySelectorAll('input[type="checkbox"]').forEach(cb => {
        cb.checked = false;
        visibleTypes.delete(cb.getAttribute('data-type'));
      });
    });

    // ============ EMBED CODE ============
    const embedToggle = document.getElementById('embed-toggle');
    const embedCode = document.getElementById('embed-code');
    const copyBtn = document.getElementById('copy-embed');

    embedToggle.addEventListener('click', () => {
      embedCode.style.display = embedCode.style.display === 'none' ? 'block' : 'none';
    });

    copyBtn.addEventListener('click', () => {
      const code = embedCode.querySelector('code').textContent;
      navigator.clipboard.writeText(code);
      copyBtn.textContent = 'Copied!';
      setTimeout(() => {
        copyBtn.textContent = 'Copy';
      }, 2000);
    });
  </script>
</body>
</html>
